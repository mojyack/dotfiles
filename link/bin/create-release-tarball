#!/bin/zsh
# run at project root

set -e

ver=$(git describe --tags --abbrev=0)
ver=${ver#v*}
proj=${PWD:t}

list="/tmp/$proj-files"

git ls-files > "$list"

args=(
    --files-from "$list"
    --transform "flags=r;s|^|$proj-$ver/|"
)

if [[ -e release.txt ]]; then
    while read line; do
        args+=$line
    done < release.txt
fi

arc="/tmp/$proj-$ver.tar.gz"
tar -zcvf "$arc" $args
echo "archive created at $arc"
